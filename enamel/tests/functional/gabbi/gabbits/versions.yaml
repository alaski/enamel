#
# Confirm the microversion handling is starting to happen.
#

fixtures:
- ConfigFixture

tests:
    - name: default version
      desc: no header sent
      GET: /
      request_headers:
        content-type: application/json
      response_headers:
        vary: /OpenStack-enamel-API-Version/
        openstack-enamel-api-version: '0.1'

    - name: latest version
      GET: /
      request_headers:
        content-type: application/json
        openstack-enamel-api-version: latest
      response_headers:
        vary: /OpenStack-enamel-API-Version/
        openstack-enamel-api-version: '1.0'

    - name: specific version
      GET: /
      request_headers:
        content-type: application/json
        openstack-enamel-api-version: '1.0'
      response_headers:
        vary: /OpenStack-enamel-API-Version/
        openstack-enamel-api-version: '1.0'

    - name: invalid version number
      GET: /
      request_headers:
        content-type: application/json
        openstack-enamel-api-version: '0.5'
      response_headers:
        vary: /OpenStack-enamel-API-Version/
        openstack-enamel-api-version: '0.1'
        content-type: application/json
      status: 406
      response_json_paths:
          $.errors[0].status: 406
          $.errors[0].title: Not Acceptable

    - name: invalid version string
      GET: /
      request_headers:
        content-type: application/json
        openstack-enamel-api-version: cow
      response_headers:
        vary: /OpenStack-enamel-API-Version/
        openstack-enamel-api-version: '0.1'
        content-type: application/json
      status: 406
      response_json_paths:
          $.errors[0].status: 406
          $.errors[0].title: Not Acceptable
          $.errors[0].detail: "406 Not Acceptable: unable to use provided version: invalid version string: cow"
